---
import HeaderLink from '@/components/HeaderLink';
import MenuIcon from './icons/MenuIcon.astro';
import Search from '@/components/Search';
import Title from './Title.astro';
import ToggleTheme from './ToggleTheme.astro';
import { SOCIALNETWORKS } from '@/data/links';
import ListContentTypes from './ListContentTypes.astro';
import { siteConfig } from '@/data/site.config';
---

<header
    class='relative flex flex-col justify-between items-center font-semibold mt-4 mb-10'
>
    <div
        class='relative flex items-center h-12 font-semibold mt-4 mb-10 w-full'
    >
        <Title title={siteConfig.displayTitle} />
        <div
            id='astro-header-drawer'
            class='shadow rounded-l-lg md:bg-transparent dark:md:bg-transparent bg-white dark:bg-[#0a0910] md:shadow-none md:rounded-none md:h-auto md:static absolute transition-all duration-300 ease-in-out hidden md:inline top-12 -right-5 pl-4 pt-6 pb-4 md:p-0 h-[200px] w-[200px] z-50'
        >
            <nav
                class='flex h-full flex-col justify-between gap-12 text-left md:flex-row md:w-full md:gap-5'
            >
                <div
                    class='flex flex-col gap-4 md:flex-row md:border-r-2 border-black pr-6 dark:border-white'
                >
                    <Search />
                </div>

                <div
                    class='flex justify-around items-center md:justify-end gap-4 md:p-0'
                >
                    {
                        SOCIALNETWORKS.map((network) => (
                            <HeaderLink
                                class='hoverLink'
                                href={network.url}
                                target='_blank'
                                aria-label={network.name}
                            >
                                <span>{<network.icon />} </span>
                            </HeaderLink>
                        ))
                    }
                </div>
            </nav>
        </div>

        <div
            class='flex items-center gap-4 md:pl-5'
            transition:persist='navbar'
        >
            <ToggleTheme />
            <button
                id='astro-header-drawer-button'
                type='button'
                class='md:ml-6 md:hidden'
            >
                <MenuIcon />
                <span class='sr-only'>Show Menu</span>
            </button>
        </div>
    </div>
    <ListContentTypes />
</header>
<script>
    document.addEventListener('click', (event) => {
        const menu = document.getElementById('astro-header-drawer');
        const menuButton = document.getElementById(
            'astro-header-drawer-button'
        );

        const isClickInside =
            menu?.contains(event.target as HTMLDivElement) ||
            menuButton?.contains(event.target as HTMLButtonElement);

        const isSearchRelated = event.target?.closest('site-search');

        if (isSearchRelated) {
            return;
        }

        if (isClickInside) {
            toggleMobileMenu(menu);
        } else {
            closeMobileMenu(menu);
        }
    });

    function toggleMobileMenu(menu: HTMLElement | null) {
        if (!menu) return;

        const isHidden = menu.classList.contains('hidden');

        if (isHidden) {
            menu.classList.remove('hidden');
            menu.classList.add('inline');
        } else {
            menu.classList.add('hidden');
            menu.classList.remove('inline');
        }
    }

    function closeMobileMenu(menu: HTMLElement | null) {
        if (!menu || menu.classList.contains('hidden')) return;

        menu.classList.add('hidden');
        menu.classList.remove('inline');
    }
</script>
