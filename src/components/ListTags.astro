---
import ContentTypeSelection from '@/components/ContentTypeSelection';
import { ContentTypeEnum } from '@/data/utils';
import { slugify } from '@/utils';

type Props = {
    tags: string[];
    activeTag: string;
};
const { tags, activeTag = '' } = Astro.props;
---

<style>
    /* Container */
    .tag-scroll {
        position: relative;
        overflow-y: auto;
        overflow-x: auto;
        scroll-behavior: smooth;
    }
</style>

<div class='relative mt-5 mb-8 mx-auto h-72'>
    <div
        id='tagScrollContainer'
        class='tag-scroll flex flex-col flex-wrap justify-center overflow-auto h-72'
        data-active={activeTag}
        client:load
    >
        {
            tags.map((tag) => (
                <ContentTypeSelection
                    text={tag}
                    slug={slugify(tag)}
                    activeOption={activeTag}
                    type={ContentTypeEnum.Tags}
                />
            ))
        }
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById('tagScrollContainer');

        if (!container) return; // nothing to do

        // --- Now handle optional scroll-to-center for active tag ---
        const activeTag = container.dataset?.active;

        // If activeTag exists, try to center it (but don't abort fades if it doesn't)
        if (activeTag && activeTag.trim() !== '') {
            const activeEl = container.querySelector(
                `[data-slug="${activeTag}"]`
            );
            if (activeEl) {
                // Compute center scrollLeft
                const containerRect = container.getBoundingClientRect();
                const elRect = activeEl.getBoundingClientRect();

                const scrollLeft =
                    container.scrollLeft +
                    (elRect.left - containerRect.left) -
                    containerRect.width / 2 +
                    elRect.width / 2;

                container.scrollTo({ left: scrollLeft, behavior: 'smooth' });
            } else {
                console.warn(
                    'activeTag present but no element found for',
                    activeTag
                );
            }
        } else {
            // No activeTag â€” ensure we start at left and fades are correct
            container.scrollTo({ left: 0 });
        }
    });
</script>
